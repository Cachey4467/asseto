好的，我帮你设计一个资金记录数据库系统文档，包含两个主要表：`Transactions` 和 `Accounts`。文档包括表结构说明、字段类型及字段含义。

---

# 资金记录数据库系统文档

## 1. 系统概述

本数据库系统用于记录用户资金流水和账户信息。其中，`Transactions` 表记录每笔资金的交易流水，`Accounts` 表管理用户的账户信息和账户余额。

---

## 2. 表结构说明

### 2.1 Config 表

| 字段名      | 类型        | 约束           | 说明                           |
|-------------|-------------|----------------|--------------------------------|
| id          | VARCHAR(64) | 主键           | 配置唯一标识                   |
| userId      | VARCHAR(64) | 非空           | 用户唯一标识                   |
| type        | VARCHAR(32) | 非空           | 配置类型（如third_party等）    |
| item        | VARCHAR(64) | 非空           | 配置项目（如longport等）       |
| subItem     | VARCHAR(64) | 非空           | 配置子项目（如LONGPORT_APP_KEY等）|
| value       | TEXT        | 非空           | 配置值                         |

**说明：**
- `type` 字段用于区分不同类型的配置，如第三方服务配置、系统配置等。
- `item` 字段用于区分同一类型下的不同服务，如longport、其他证券API等。
- `subItem` 字段用于区分同一服务下的不同配置项，如API密钥、访问令牌等。
- `value` 存储具体的配置值，使用TEXT类型以支持长字符串。

### 2.2 ForeignExchangeRate 表

| 字段名          | 类型        | 约束           | 说明                           |
|-----------------|-------------|----------------|--------------------------------|
| id              | VARCHAR(64) | 主键           | 汇率记录唯一标识               |
| foreign_currency| VARCHAR(10) | 非空           | 外币代码（如USD、HKD等）       |
| buy_in_price    | TEXT        | 非空           | 买入价                         |
| sell_out_price  | TEXT        | 非空           | 卖出价                         |
| date            | DATE        | 非空           | 汇率日期                       |
| created_at      | DATETIME    | 默认当前时间   | 记录创建时间                   |

**说明：**
- `foreign_currency` 存储外币代码，如USD（美元）、HKD（港币）等。
- `buy_in_price` 和 `sell_out_price` 使用TEXT类型存储高精度数值。
- `date` 字段用于标识汇率的生效日期。
- 该表作为外汇汇率的缓存，避免重复调用外部API。

### 2.3 Transactions 表

| 字段名      | 类型        | 约束           | 说明                           |
|-------------|-------------|----------------|--------------------------------|
| id          | VARCHAR     | 主键           | 交易唯一标识                   |
| userId      | VARCHAR     | 非空           | 用户唯一标识                   |
| accountId   | VARCHAR     | 非空           | 关联账户唯一标识               |
| description | VARCHAR     | 可空           | 交易描述                       |
| date        | DATETIME    | 非空           | 交易日期时间                   |
| direction   | TINYINT(1)  | 非空，0或1      | 资金流向，0=入账，1=出账       |
| quantity    | TEXT        | 非空          | 交易数量，金融小数             |
| price       | TEXT        | 非空          | 价格，金融小数                 |
| currency    | VARCHAR(10) | 非空           | 货币类型（如CNY、USD等）       |

**说明：**
- `direction` 字段只允许取值0（入账）和1（出账），用于区分资金流入还是流出。
- `quantity` 和 `price` 使用高精度金融小数类型，支持数量的准确计算。
- `currency` 表示交易使用的货币单位。

---

### 2.4 Accounts 表

| 字段名      | 类型           | 约束           | 说明                           |  
|-------------|----------------|----------------|--------------------------------|  
| id          | VARCHAR        | 主键           | 账户唯一标识                   |  
| userId      | VARCHAR        | 非空           | 账户所属用户唯一标识           |  
| symbol      | VARCHAR        | 非空           | 账户代码（现实资产唯一编号如股票代码、房产编号等）|
| type        | VARCHAR        | 非空           | 账户类型（如现金、银行等）     |
| parentId    | VARCHAR        | 可空           | 上级账户ID，用于账户层级管理   |  
| description | VARCHAR        | 可空           | 账户描述，用于前端显示        |  
| quantity    | TEXT           | 非空           | 账户数量，金融小数             |  
| cost        | TEXT           | 非空           | 获得此资产的成本，金融小数     |
| marketPrice | TEXT           | 可空           | 当前市场价，金融小数           |  
| currency    | VARCHAR(10)    | 非空           | 账户货币类型（如CNY、USD等）  |  
| isActive    | BOOLEAN        | 非空，默认 true | 账户是否活跃                   |  


**说明：**
- `parentId` 用于实现账户层级结构，如分级账户管理。
- `quantity` 反映该账户当前资产数量。
- `cost` 表示获得该资产的成本价格。
- `marketPrice` 表示该资产的当前市场价，用于计算当前价值。

---

## 3. 索引建议

- `Config.table`：为了快速查找用户的配置信息，建议对 `userId`、`type`、`item` 建立复合索引。
- `ForeignExchangeRate.table`：为了快速查找汇率信息，建议对 `foreign_currency`、`date` 建立复合索引，对 `date` 建立单独索引。
- `Transactions.table`：为了快速查找某账户或某用户的交易记录，建议对 `userId` 和 `accountId` 建立索引。
- `Accounts.table`：为方便快速查询用户所有账户信息，建议对 `userId` 建立索引。

---

## 4. 关系说明

- 一个用户（userId）可以拥有多个配置项（Config 表），配置与用户通过 `userId` 关联。
- 一个用户（userId）可以拥有多个账户（Accounts 表），账户与用户通过 `userId` 关联。
- 一个账户可以有多笔交易流水（Transactions 表），通过 `accountId` 关联。
- `Transactions` 表中的 `userId` 用于关联交易所属用户，保证数据一致性。
- `ForeignExchangeRate` 表独立存储外汇汇率数据，用于缓存和查询历史汇率。

---

## 5. 示例SQL建表语句

```sql
CREATE TABLE Config (
  id VARCHAR(64) PRIMARY KEY,
  userId VARCHAR(64) NOT NULL,
  type VARCHAR(32) NOT NULL,
  item VARCHAR(64) NOT NULL,
  subItem VARCHAR(64) NOT NULL,
  value TEXT NOT NULL,
  INDEX idx_userId_type_item (userId, type, item)
);

CREATE TABLE ForeignExchangeRate (
  id VARCHAR(64) PRIMARY KEY,
  foreign_currency VARCHAR(10) NOT NULL,
  buy_in_price TEXT NOT NULL,
  sell_out_price TEXT NOT NULL,
  date DATE NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_foreign_currency_date (foreign_currency, date),
  INDEX idx_date (date)
);

CREATE TABLE Accounts (
  id VARCHAR(64) PRIMARY KEY,
  userId VARCHAR(64) NOT NULL,
  symbol VARCHAR(32) NOT NULL,
  type VARCHAR(32) NOT NULL,
  parentId VARCHAR(64),
  description VARCHAR(255),
  quantity TEXT NOT NULL,
  cost TEXT NOT NULL,
  marketPrice TEXT,
  INDEX idx_userId (userId)
);

CREATE TABLE Transactions (
  id VARCHAR(64) PRIMARY KEY,
  userId VARCHAR(64) NOT NULL,
  accountId VARCHAR(64) NOT NULL,
  description VARCHAR(255),
  date DATETIME NOT NULL,
  direction TINYINT(1) NOT NULL CHECK (direction IN (0,1)),
  quantity TEXT NOT NULL,
  price TEXT NOT NULL,
  currency VARCHAR(10) NOT NULL,
  INDEX idx_userId (userId),
  INDEX idx_accountId (accountId),
  FOREIGN KEY (accountId) REFERENCES Accounts(id)
);
```
